<div class="admonition note">
    <h3><a title="Curso Symfony2" href="http://juandarodriguez.es/cursosf20/" target="_blank">Acceso al curso Symfony2 completo</a></h3>
</div>
Inyección de Dependencia (<em>Dependency Injection</em>), Inversión de Control (<em>Control
    Inversion</em>), Contenedor de Servicios (<em>Service Container</em>) y Contenedor
de Dependencias (<em>Dependency Container</em>) son palabros que te vas a encontrar
continuamente cuando te sumerges en el mundo de <em>Symfony2</em>. Todas hacen
referencia a una misma cosa: un patrón de diseño, en el <em>“que se suministran
    objetos a una clase en lugar de ser la propia clase quien cree los objetos”</em>
(definición encontrada en la <em>Wikipedia</em> y bastante acertada para lo cortita
que es).

Este patrón es muy popular en el mundo de <em>Java</em> y ha sido muy bien explicado
por un famoso gurú del desarrollo de software: <em>Martin Fowler</em> <a class="footnote-reference" id="id1" href="#id2">[1]</a>. Los creadores
de <em>Symfony2</em> han comprendido su eficacia para organizar sistemas compuestos
por muchos objetos que presentan dependencias entre ellos y han decidido
diseñar la arquitectura del framework <em>Symfony2</em> alrededor de este patrón.

Y ya está bien de palabritas de presentación. Vamos a contarlo. Lo haremos
directamente con ejemplos, aquí se aplica al cien por cien aquello de que
<em>una imagen vale más que mil palabras</em>.

En un sistema software orientado a objetos, como puede ser un framework de
desarrollo web, se llevan a cabo tareas de distinta índole: interpretar la
petición <em>HTTP</em>, construir una respuesta <em>HTTP</em>, manipular la sesión, controlar
la autentificación y autorización, persistir los datos en una base de datos,
contruir formularios, validar datos, crear documentos <em>HTML</em>, <em>JSON</em>, <em>XML</em> y
de otros tipos, enviar <em>e-mails</em>, mapear las <em>URL’s</em> en acciones, y otras tareas
que pueden ser incorporadas por el desarrollador de la aplicación. Cada una de
estas tareas se delega en distintos objetos atendiendo al principio de separación
de ámbitos (<em>Separation Of Concern</em>). Este tipo de objetos que realizan algún tipo
de tarea “global” en el sistema se denominan <em>Servicios</em>, para diferenciarlos de
los objetos que tienen utilidad en partes concretas de la aplicación, esto es
que se crean y se destruyen en el momento en que han realizado su labor. Estos
últimos objetos son más propios de la lógica de negocio de la aplicación
(por ejemplo un objeto <em>Documento</em> en un aplicación de gestión documental).

Es muy usual, prácticamente lo normal, que los servicios dependan de parámetros
de configuración e incluso de otros servicios que a su vez dependen de
parámetros de configuración y, posiblemente, de otros servicios. Por ejemplo,
un servicio de persistencia de datos va a depender de los parámetros de conexión
a la base de datos, un servicio de <em>mailing</em> dependerá de los parámetros de
conexión al servidor <em>SMTP</em>, un servicio diseñado para registrar usuarios puede
depender del servicio de persistencia y del servicio de <em>mailing</em>. Y así hasta
que construyamos nuestro sistema completo.
<div class="section" id="primer-paso-injeccion-de-dependencias"><span id="inyeccion"></span>
    <h2>Primer paso: inyección de dependencias<a class="headerlink" title="Enlazar permanentemente con este título" href="#primer-paso-injeccion-de-dependencias">¶</a></h2>
    El primer paso en la aplicación del patrón consiste en diseñar los servicios
    de manera que NO construyan ellos mismos los servicios de los cuales dependen,
    sino que los servicios dependientes se pasen debidamente construidos a través
    del constructor. Es decir si un servicio <tt class="docutils literal"><span class="pre">S2</span></tt> depende de otro servicio <tt class="docutils literal"><span class="pre">S1</span></tt>,
    lo siguiente no cumple el patrón:
    <div class="highlight-php">
        <table class="highlighttable">
            <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
<pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre>
                    </div></td>
                <td class="code">
                    <div class="highlight">
<pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">S1</span> <span class="p">{</span>

<span class="k">public</span> <span class="nx">__construct</span><span class="p">(</span><span class="nv">$p11</span><span class="p">,</span><span class="nv">$p12</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="nv">$p1n</span><span class="p">)</span>
<span class="p">{</span><span class="o">...</span><span class="p">}</span>

<span class="o">...</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">S2</span> <span class="p">{</span>

<span class="k">public</span> <span class="nx">__construct</span><span class="p">(</span><span class="nv">$p21</span><span class="p">,</span><span class="nv">$p22</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="nv">$p2m</span><span class="p">)</span>
<span class="p">{</span>
 <span class="o">...</span>
 <span class="nv">$s2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">S1</span><span class="p">(</span><span class="nv">$p11</span><span class="p">,</span><span class="nv">$p12</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="nv">$p1n</span><span class="p">);</span>
 <span class="o">...</span>
<span class="p">}</span></pre>
                    </div></td>
            </tr>
            </tbody>
        </table>
    </div>
    En su lugar las clases anteriores se escribirían así:
    <div class="highlight-php">
        <table class="highlighttable">
            <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
<pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre>
                    </div></td>
                <td class="code">
                    <div class="highlight">
<pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">S1</span> <span class="p">{</span>

<span class="k">public</span> <span class="nx">__construct</span><span class="p">(</span><span class="nv">$p11</span><span class="p">,</span><span class="nv">$p12</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="nv">$p1n</span><span class="p">)</span>
<span class="p">{</span><span class="o">...</span><span class="p">}</span>

<span class="o">...</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">S2</span> <span class="p">{</span>

<span class="k">public</span> <span class="nx">__construct</span><span class="p">(</span><span class="nx">S1</span> <span class="nv">$s1</span> <span class="nv">$p21</span><span class="p">,</span><span class="nv">$p22</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="nv">$p2m</span><span class="p">)</span>
<span class="p">{</span><span class="o">...</span> <span class="p">}</span></pre>
                    </div></td>
            </tr>
            </tbody>
        </table>
    </div>
    Esto es, para instanciar un objeto <tt class="docutils literal"><span class="pre">S2</span></tt>, hay que crear previamente un objeto
    <tt class="docutils literal"><span class="pre">S1</span></tt> y, entonces pasarselo como argumento en la construcción del objeto <tt class="docutils literal"><span class="pre">S2</span></tt>.
    Esta manera de tratar las dependencias, mediante <em>inyección</em> en los objetos,
    redunda en un <strong>sistema más desacoplado</strong>. Si en un momento dado tenemos que
    cambiar, la clase <tt class="docutils literal"><span class="pre">S1</span></tt> por <tt class="docutils literal"><span class="pre">S1bis</span></tt>, en el primer plantemiento tenemos que
    tocar el código de la clase <tt class="docutils literal"><span class="pre">S2</span></tt>, mientras que en el segundo, si la clases
    <tt class="docutils literal"><span class="pre">S1bis</span></tt> mantiene la misma interfaz que <tt class="docutils literal"><span class="pre">S1</span></tt> todo seguiría funcionando sin
    más que pasarle al constructor de <tt class="docutils literal"><span class="pre">S2</span></tt> un objeto de <tt class="docutils literal"><span class="pre">S1bis</span></tt> en lugar de uno
    de <tt class="docutils literal"><span class="pre">S1</span></tt>.

    Esta es la parte fácil de patrón. De hecho, es muy probable que hayas usado más de
    una vez esta manera de construir los objetos sin haber oído nunca hablar de la
    “inyección de dependencias”

</div>
<div class="section" id="segundo-paso-el-contenedor-de-dependencias">
    <h2>Segundo paso: el contenedor de dependencias<a class="headerlink" title="Enlazar permanentemente con este título" href="#segundo-paso-el-contenedor-de-dependencias">¶</a></h2>
    No obstante, cuando el sistema contenga un número considerable de servicios, las
    relaciones de dependencia pueden llegar a ser bastante complejas. Entonces, lo que
    hemos ganado en flexibilidad al separar las tareas en distintos objetos o
    servicios, lo perdemos en complejidad a la hora de instanciarlos, pues hay que
    tener en cuenta todas las dependencias para instanciar correctamente un servicio.

    La siguiente figura ilustra una imagen gráfica de lo que acabamos de decir. Los
    servicios (objetos) se han representado con un círculo, y los parámetros de
    configuración con un cuadrado. Observese que un mismo parámetro de configuración
    puede ser utilizado por varios servicios, y un mismo servicio puede ser
    utilizado por varios servicios.

    <a href="http://juandarodriguez.es/wp-content/uploads/dependency_injection1.png"><img class="alignnone size-medium wp-image-337" title="dependency_injection" alt="" src="http://juandarodriguez.es/wp-content/uploads/dependency_injection1-300x215.png" width="300" height="215" /></a>

    Si en alguna parte de la aplicación necesitamos utilizar el servicio <tt class="docutils literal"><span class="pre">S4</span></tt>
    en <em>PHP</em> haríamos algo así:
    <div class="highlight-php">
        <table class="highlighttable">
            <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
<pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre>
                    </div></td>
                <td class="code">
                    <div class="highlight">
<pre><span class="cp">&lt;?php</span>
 <span class="o">...</span>

 <span class="nv">$params</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
     <span class="s1">'p1'</span> <span class="o">=&gt;</span> <span class="s1">'v1'</span><span class="p">,</span>
     <span class="s1">'p2'</span> <span class="o">=&gt;</span> <span class="s1">'v2'</span><span class="p">,</span>
     <span class="s1">'p3'</span> <span class="o">=&gt;</span> <span class="s1">'v3'</span><span class="p">,</span>
     <span class="s1">'p4'</span> <span class="o">=&gt;</span> <span class="s1">'v4'</span><span class="p">,</span>
     <span class="s1">'p5'</span> <span class="o">=&gt;</span> <span class="s1">'v5'</span><span class="p">,</span>
     <span class="s1">'p6'</span> <span class="o">=&gt;</span> <span class="s1">'v6'</span><span class="p">,</span>
  <span class="p">);</span>

 <span class="nv">$s1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">S1</span><span class="p">(</span><span class="nv">$params</span><span class="p">[</span><span class="s1">'p1'</span><span class="p">],</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">'p2'</span><span class="p">]);</span>

 <span class="nv">$s2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">S2</span><span class="p">(</span><span class="nv">$params</span><span class="p">[</span><span class="s1">'p3'</span><span class="p">]);</span>

 <span class="nv">$s4</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">S4</span><span class="p">(</span><span class="nv">$s1</span><span class="p">,</span> <span class="nv">$s2</span><span class="p">,</span> <span class="nv">$params</span><span class="p">[</span><span class="s1">'p6'</span><span class="p">]);</span>

 <span class="c1">// y ya podemos usar $s4</span></pre>
                    </div></td>
            </tr>
            </tbody>
        </table>
    </div>
    Como puedes comprobar resulta un poco engorroso; tenemos que conocer las
    relaciones de dependencias entre los servicios para realizar una instancia
    correcta. ¿Qué podemos hacer para seguir gozando de la flexibilidad ofrecida
    por un conjunto de objetos desacoplados y evitar, a la vez, tener que instanciar
    todas las dependencias de un objeto cada vez que lo necesitamos?

    La respuesta a esta pregunta es la segunda parte del patrón, y es lo que, en
    nuestra opinión, lo hace realmente útil. Se trata de elaborar un objeto
    <em>“inteligente”</em> que conozca las dependencias de los servicios y sea capaz de
    construir cualquier servicio que le pidamos y entregarnóslo bien configurado, listo
    para su uso, sin que nos tengamos que preocupar de instanciar e “inyectar”sus
    dependencias. Este objeto tan fantástico y listo se denomina <em>“Injector de
        Dependencias”</em>, <em>“Contenedor de Dependencias”</em>, <em>“Contenedor de Servicios”</em> o,
    simplemente <em>“Contenedor”</em>. Nosotros utilizaremos preferentemente el término:
    “Contenedor de Servicios”. Si contásemos con un ” Contenedor de Servicios”
    implementado, por ejemplo, en una clase llamada <tt class="docutils literal"><span class="pre">Container</span></tt>, el código anterior
    quedaría así.
    <div class="highlight-php">
        <table class="highlighttable">
            <tbody>
            <tr>
                <td class="linenos">
                    <div class="linenodiv">
<pre>1
2
3
4
5
6
7
8</pre>
                    </div></td>
                <td class="code">
                    <div class="highlight">
<pre><span class="cp">&lt;?php</span>
 <span class="o">...</span>

 <span class="nv">$container</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Container</span><span class="p">(</span><span class="s1">'/ruta/a/fichero/de/configuracion'</span><span class="p">);</span>

 <span class="nv">$s4</span> <span class="o">=</span> <span class="nv">$container</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'S4'</span><span class="p">);</span>

 <span class="c1">// y ya podemos usar $s4</span></pre>
                    </div></td>
            </tr>
            </tbody>
        </table>
    </div>
    Es decir, creamos un “Contenedor de Servicios” y le pedimos una instancia del
    servicio <tt class="docutils literal"><span class="pre">S4</span></tt> que es el que vamos a usar en ese momento. ¡Y ya está!. El
    contenedor se encarga de construir los objetos necesarios con los parámetros de
    configuración correctos.
    <div class="admonition important">
        <p class="first admonition-title">Importante</p>
        <p class="last">Con la aplicación de este patrón, <strong>se ha separado la configuración de los
                servicios de su uso</strong>. Reflexiona acerca de esta última frase; resume bastante
            bien la finalidad del patrón <em>Inyección de Dependencias</em></p>

    </div>
    Bueno, en realidad esto suena muy bien pero no hemos hablado del principal problema:
    ¿cómo diseñamos y elaboramos un objeto tan magnífico e inteligente?. El problema
    no es nada sencillo. Lo que está claro es que ese objeto debe conocer todas las
    dependencias de los servicios de la aplicación. Por eso hemos pasado como
    argumento a nuestro hipotético contenedor un, también hipotético, fichero de
    configuración donde estarían definidas dichas dependencias.

    No vamos a invertir tiempo en contar el diseño y construcción de un “Contenedor
    de Servicios”. Aunque es un ejercicio realmente interesante e instructivo, el
    tutorial va de <em>Symfony2</em>, así que contaremos, directamente, como funciona el que
    trae incorporado este framework a través de su componente <em>DependencyInjection</em>.
    Mostraremos su uso integrando la clase <tt class="docutils literal"><span class="pre">Model</span></tt> de la aplicación de gestión de
    alimentos como un servicio.
    <div class="admonition note">
        <p class="first admonition-title">Nota</p>
        La aplicación a la que nos referimos es la que se desarrolla en este otro tutorial:

        <a class="reference external" href="http://juandarodriguez.es/tutoriales/tutorial-de-symfony2/">http://juandarodriguez.es/tutoriales/tutorial-de-symfony2/</a>
        <p class="last">Si quieres probar todo lo que se dice en los siguientes apartados, al menos deberías
            copiar el código del tutorial sobre <em>Symfony2</em> del enlace anterior. No obstante, para
            comprender el funcionamiento de la inyección de dependencias en <em>Symfony2</em> basta con
            que eches un vistazo a la clase <tt class="docutils literal"><span class="pre">Model</span></tt> (puedes verla en <a class="reference external" href="http://juandarodriguez.es/tutoriales-2/tutorial-de-symfony2/#implementamos-el-resto-de-la-aplicacion">http://juandarodriguez.es/tutoriales-2/tutorial-de-symfony2/#implementamos-el-resto-de-la-aplicacion</a>) y leas detenidamente
            este tutorial.</p>

    </div>
</div>
<div class="section" id="integracion-de-la-clase-model-como-un-servicio-de-symfony2">
    <h2>Integración de la clase <tt class="docutils literal"><span class="pre">Model</span></tt> como un servicio de <em>Symfony2</em><a class="headerlink" title="Enlazar permanentemente con este título" href="#integracion-de-la-clase-model-como-un-servicio-de-symfony2">¶</a></h2>
    La clase <tt class="docutils literal"><span class="pre">Model</span></tt> de nuestra aplicación realiza un tipo de tarea “global” en
    el framework; conectarse a la base de datos <em>MySQL</em> para realizar operaciones
    sobre sus datos. Por tanto se trata de un servicio en el sentido que hemos explicado
    anteriormente. Para convertirla en un servicio de <em>Symfony2</em> no hay que tocar nada
    de su código, ya que todas sus dependencias son pasadas (inyectadas) a través del
    constructor, tal y como se ha explicado en el punto anterior. Tan sólo debemos
    “decirle” al Contenedor de Servicios <em>Symfony2</em> que la añada al conjunto de
    servicios que es capaz de manipular. Y es lo que haremos.
    <div class="admonition note">
        <p class="first admonition-title">Nota</p>
        <p class="last">Para que el <em>Contenedor de Dependencias</em> pueda crear instancias de la clase
            que vamos a integrar como servicio, dicha clase debe construirse como se ha
            indicado en el apartado <a class="reference internal" href="#inyeccion"><em>Primer paso: inyección de dependencias</em></a>, es decir, los objetos que requiera
            la clase no deben ser instanciados por ella, sino pasados ya construidos a
            través de su constructor.</p>

    </div>
    Todos los <em>bundles</em> construidos con el generador de <em>bundles</em> de <em>Symfony2</em>,
    proporcionan el fichero <tt class="docutils literal"><span class="pre">Resources/config/services.yml</span></tt>. Échale un vistazo.
    Trae algunas líneas comentadas para que sirvan como ejemplo. En este fichero se
    describen los servicios del <em>bundle</em> y sus dependencias. El fichero tiene dos
    secciones; <tt class="docutils literal"><span class="pre">parameters</span></tt> y <tt class="docutils literal"><span class="pre">services</span></tt>. La primera sirve para declarar
    parámetros de configuración, y la segunda para declarar los servicios (los nombres
    lo dicen todo). Los parámetros declarados en la sección <tt class="docutils literal"><span class="pre">parameters</span></tt>, pueden ser
    referenciados en cualquier fichero de configuración del framework rodeando su
    nombre con el caracter <tt class="docutils literal"><span class="pre">%</span></tt>. Para incorporar la clase <tt class="docutils literal"><span class="pre">Model</span></tt> como servicio de
    <em>Symfony2</em> debemos añadir al fichero <tt class="docutils literal"><span class="pre">services.yml</span></tt> el siguiente código.

    <tt class="docutils literal"><span class="pre">src/Jazzyweb/AulasMentor/AlimentosBundle/Resources/config/services.yml</span></tt>
    <div class="highlight-yaml">
<pre>parameters:
  jamab.database_name: alimentos
  jamab.database_user: root
  jamab.database_password: root
  jamab.database_host: localhost
  jamab.model.class: Jazzyweb\AulasMentor\AlimentosBundle\Model\Model

services:
  jamab.model:
     class: %jamab.model.class%
     arguments: [%jamab.database_name%, %jamab.database_user%, %jamab.database_password%, %jamab.database_host%]</pre>
    </div>
    La sección <tt class="docutils literal"><span class="pre">parameters</span></tt> es autodescriptiva. El nombre de los parámetros de
    configuración puede ser cualquiera. Hemos antepuesto el prefijo <tt class="docutils literal"><span class="pre">jamab</span></tt> para
    evitar posibles colisiones con otros <em>bundles</em>. Observa que hemos parametrizado
    incluso el nombre de la clase. La idea es que la definición de todo lo que sea
    parametrizable, es decir, susceptible de ser cambiado, se encuentre juntito y
    fácilmente localizable.

    En la sección <tt class="docutils literal"><span class="pre">services</span></tt>, cada servicio es declarado con un nombre único.
    Podemos elegir el que queramos siempre que no coincida con otro que ya exista
    en el sistema. Por eso es siempre una buena práctica usar un prefijo que haga
    referencia al <em>bundle</em>. En nuestro caso hemos llamado al servicio: <tt class="docutils literal"><span class="pre">jamab.model</span></tt>.

    A continuación hay que indicar qué clase implementa el servicio y qué argumentos
    necesita dicha clase para crear objetos de su tipo. Las directivas <tt class="docutils literal"><span class="pre">class</span></tt> y
    <tt class="docutils literal"><span class="pre">arguments</span></tt> recogen dicha información. Fíjate la forma de referenciar los
    parámetros de configuración con el carácter <tt class="docutils literal"><span class="pre">%</span></tt>.

    Esta información es todo lo que necesita <em>Symfony2</em> para incorporar la clase
    <tt class="docutils literal"><span class="pre">Model</span></tt> como servicio del framework. Ahora podrás obtener instancias de la misma
    a través del “Contenedor de Servicios” de <em>Symfony2</em>.

</div>
<div class="section" id="el-contenedor-de-servicios-de-symfony2">
<h2>El Contenedor de Servicios de <em>Symfony2</em><a class="headerlink" title="Enlazar permanentemente con este título" href="#el-contenedor-de-servicios-de-symfony2">¶</a></h2>
La clase <tt class="docutils literal"><span class="pre">Symfony\Bundle\FrameworkBundle\Controller\Controller</span></tt> del framework,
proporciona en un atributo público llamado <tt class="docutils literal"><span class="pre">container</span></tt>, una instancia del
contenedor de dependecias. Por tanto, desde cualquier clase derivada de
<tt class="docutils literal"><span class="pre">Symfony\Bundle\FrameworkBundle\Controller\Controller</span></tt> se puede obtener una
instancia del Contenedor de Dependencias así:
<div class="highlight-python">
    <pre>$c = $this-&gt;container;</pre>
</div>
Y una vez que lo tengamos podemos instanciar cualquier servicio existente a través
del método <tt class="docutils literal"><span class="pre">get()</span></tt> del Contenedor de Servicios. A este método se le pasa como
argumento una <em>string</em> con el nombre que se le ha dado a dicho servicio en la
declaración del mismo. Por ejemplo para obtener una instancia del servicio que
acabamos de crear con la clase <tt class="docutils literal"><span class="pre">Model</span></tt>, haríamos lo siguiente:
<div class="highlight-python">
    <pre>$c = $this-&gt;container-&gt;get('jamab.model');</pre>
</div>
O más sencillo aún:
<div class="highlight-python">
    <pre>$c = $this-&gt;get('jamab.model');</pre>
</div>
Ya que el método <tt class="docutils literal"><span class="pre">get()</span></tt> de la clase <tt class="docutils literal"><span class="pre">Symfony\Bundle\FrameworkBundle\Controller\Controller</span></tt>,
es un <tt class="docutils literal"><span class="pre">wrapper</span></tt>, es decir llama directamente al método <tt class="docutils literal"><span class="pre">get()</span></tt> del Contenedor
de Dependencia de <em>Symfony2</em>.

Como nuestro controlador <tt class="docutils literal"><span class="pre">DefaultController</span></tt> extiende a la clase
<tt class="docutils literal"><span class="pre">Symfony\Bundle\FrameworkBundle\Controller\Controller</span></tt>, podemos obtener instancias
de la clase <tt class="docutils literal"><span class="pre">Model</span></tt> a través del Contenedor de Servicios de <em>Symfony2</em>. El
código de la clase <tt class="docutils literal"><span class="pre">DefaultController</span></tt> quedaría así:

<tt class="docutils literal"><span class="pre">src/Jazzyweb/AulasMentor/AlimentosBundle/Controller/DefaultController.php</span></tt>
<div class="highlight-php">
<table class="highlighttable">
<tbody>
<tr>
<td class="linenos">
    <div class="linenodiv">
<pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102</pre>
    </div></td>
<td class="code">
    <div class="highlight">
<pre><span class="cp">&lt;?php</span>

 <span class="k">namespace</span> <span class="nx">Jazzyweb\AulasMentor\AlimentosBundle\Controller</span><span class="p">;</span>

 <span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\Controller</span><span class="p">;</span>

 <span class="k">class</span> <span class="nc">DefaultController</span> <span class="k">extends</span> <span class="nx">Controller</span>
 <span class="p">{</span>

     <span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
     <span class="p">{</span>
         <span class="nv">$params</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
             <span class="s1">'mensaje'</span> <span class="o">=&gt;</span> <span class="s1">'Bienvenido al curso de Symfony2'</span><span class="p">,</span>
             <span class="s1">'fecha'</span> <span class="o">=&gt;</span> <span class="nb">date</span><span class="p">(</span><span class="s1">'d-m-yyy'</span><span class="p">),</span>
         <span class="p">);</span>

         <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">'JazzywebAulasMentorAlimentosBundle:Default:index.html.twig'</span><span class="p">,</span> <span class="nv">$params</span><span class="p">);</span>
     <span class="p">}</span>

     <span class="k">public</span> <span class="k">function</span> <span class="nf">listarAction</span><span class="p">()</span>
     <span class="p">{</span>
         <span class="nv">$m</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'jamab.model'</span><span class="p">);</span>

         <span class="nv">$params</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
             <span class="s1">'alimentos'</span> <span class="o">=&gt;</span> <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">dameAlimentos</span><span class="p">(),</span>
         <span class="p">);</span>

         <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">'JazzywebAulasMentorAlimentosBundle:Default:mostrarAlimentos.html.twig'</span><span class="p">,</span>
          <span class="nv">$params</span><span class="p">);</span>
     <span class="p">}</span>

     <span class="k">public</span> <span class="k">function</span> <span class="nf">insertarAction</span><span class="p">()</span>
     <span class="p">{</span>
         <span class="nv">$params</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
             <span class="s1">'nombre'</span> <span class="o">=&gt;</span> <span class="s1">''</span><span class="p">,</span>
             <span class="s1">'energia'</span> <span class="o">=&gt;</span> <span class="s1">''</span><span class="p">,</span>
             <span class="s1">'proteina'</span> <span class="o">=&gt;</span> <span class="s1">''</span><span class="p">,</span>
             <span class="s1">'hc'</span> <span class="o">=&gt;</span> <span class="s1">''</span><span class="p">,</span>
             <span class="s1">'fibra'</span> <span class="o">=&gt;</span> <span class="s1">''</span><span class="p">,</span>
             <span class="s1">'grasa'</span> <span class="o">=&gt;</span> <span class="s1">''</span><span class="p">,</span>
         <span class="p">);</span>

         <span class="nv">$m</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'jamab.model'</span><span class="p">);</span>

         <span class="k">if</span> <span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REQUEST_METHOD'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'POST'</span><span class="p">)</span> <span class="p">{</span>

             <span class="c1">// comprobar campos formulario</span>
             <span class="k">if</span> <span class="p">(</span><span class="nv">$m</span><span class="o">-&gt;</span><span class="na">insertarAlimento</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'nombre'</span><span class="p">],</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'energia'</span><span class="p">],</span>
                 <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'proteina'</span><span class="p">],</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'hc'</span><span class="p">],</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'fibra'</span><span class="p">],</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'grasa'</span><span class="p">]))</span> <span class="p">{</span>
                 <span class="nv">$params</span><span class="p">[</span><span class="s1">'mensaje'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'Alimento insertado correctamente'</span><span class="p">;</span>
             <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                 <span class="nv">$params</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
                     <span class="s1">'nombre'</span> <span class="o">=&gt;</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'nombre'</span><span class="p">],</span>
                     <span class="s1">'energia'</span> <span class="o">=&gt;</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'energia'</span><span class="p">],</span>
                     <span class="s1">'proteina'</span> <span class="o">=&gt;</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'proteina'</span><span class="p">],</span>
                     <span class="s1">'hc'</span> <span class="o">=&gt;</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'hc'</span><span class="p">],</span>
                     <span class="s1">'fibra'</span> <span class="o">=&gt;</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'fibra'</span><span class="p">],</span>
                     <span class="s1">'grasa'</span> <span class="o">=&gt;</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'grasa'</span><span class="p">],</span>
                 <span class="p">);</span>
                 <span class="nv">$params</span><span class="p">[</span><span class="s1">'mensaje'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'No se ha podido insertar el alimento. Revisa el formulario'</span><span class="p">;</span>
             <span class="p">}</span>
         <span class="p">}</span>

         <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">'JazzywebAulasMentorAlimentosBundle:Default:formInsertar.html.twig'</span><span class="p">,</span>
          <span class="nv">$params</span><span class="p">);</span>
     <span class="p">}</span>

     <span class="k">public</span> <span class="k">function</span> <span class="nf">buscarPorNombreAction</span><span class="p">()</span>
     <span class="p">{</span>
         <span class="nv">$params</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
             <span class="s1">'nombre'</span> <span class="o">=&gt;</span> <span class="s1">''</span><span class="p">,</span>
             <span class="s1">'resultado'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(),</span>
         <span class="p">);</span>

         <span class="nv">$m</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'jamab.model'</span><span class="p">);</span>

         <span class="k">if</span> <span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REQUEST_METHOD'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'POST'</span><span class="p">)</span> <span class="p">{</span>
             <span class="nv">$params</span><span class="p">[</span><span class="s1">'nombre'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'nombre'</span><span class="p">];</span>
             <span class="nv">$params</span><span class="p">[</span><span class="s1">'resultado'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">buscarAlimentosPorNombre</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'nombre'</span><span class="p">]);</span>
         <span class="p">}</span>

         <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">'JazzywebAulasMentorAlimentosBundle:Default:buscarPorNombre.html.twig'</span><span class="p">,</span>
          <span class="nv">$params</span><span class="p">);</span>
     <span class="p">}</span>

     <span class="k">public</span> <span class="k">function</span> <span class="nf">verAction</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
     <span class="p">{</span>
         <span class="nv">$m</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'jamab.model'</span><span class="p">);</span>

         <span class="nv">$alimento</span> <span class="o">=</span> <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">dameAlimento</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

         <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$alimento</span><span class="p">)</span> <span class="p">{</span>
             <span class="k">throw</span> <span class="k">new</span> <span class="nx">\Symfony\Component\HttpKernel\Exception\AccessDeniedHttpException</span><span class="p">();</span>
         <span class="p">}</span>

         <span class="nv">$params</span> <span class="o">=</span> <span class="nv">$alimento</span><span class="p">;</span>

         <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">'JazzywebAulasMentorAlimentosBundle:Default:verAlimento.html.twig'</span><span class="p">,</span>
          <span class="nv">$params</span><span class="p">);</span>
     <span class="p">}</span>

 <span class="p">}</span></pre>
    </div></td>
</tr>
</tbody>
</table>
</div>
Observa (líneas 22, 43, 75 y 88) que ya no tenemos que pasar parámetros de
configuración para obtener una instancia de la clase <tt class="docutils literal"><span class="pre">Model</span></tt>, puesto que el
Contenedor de Servicios sabe hacerlo y lo hace por nosotros. Como consecuencia,
ya no es necesario la clase <tt class="docutils literal"><span class="pre">Jazzyweb\AulasMentor\AlimentosBundle\Config\Config</span></tt>,
puesto que los parámetros de configuración han sido definidos en el archivo
<tt class="docutils literal"><span class="pre">src/Jazzyweb/AulasMentor/AlimentosBundle/Resources/config/services.yml</span></tt>. Así
que puedes borrarla (¡menos mal! era una clase que “chirriaba” demasiado).
<div class="admonition note">
    <p class="first admonition-title">Nota</p>
    <p class="last">Si no has seguido el tutorial <a class="reference external" href="http://juandarodriguez.es/tutoriales/tutorial-de-symfony2/">http://juandarodriguez.es/tutoriales/tutorial-de-symfony2/</a>, echa un vistazo al código del <tt class="docutils literal"><span class="pre">DefaultController.php</span></tt> que se encuentra en el apartado: <a class="reference external" href="http://juandarodriguez.es/tutoriales-2/tutorial-de-symfony2/#implementamos-el-resto-de-la-aplicacion">http://juandarodriguez.es/tutoriales-2/tutorial-de-symfony2/#implementamos-el-resto-de-la-aplicacion</a> para comprobar lo que se dice en el apartado anterior.</p>

</div>
</div>
<div class="section" id="y-que-hemos-ganado-con-todo-esto">
<h2>¿Y qué hemos ganado con todo esto?<a class="headerlink" title="Enlazar permanentemente con este título" href="#y-que-hemos-ganado-con-todo-esto">¶</a></h2>
Es muy probable que estes preguntándote qué hemos ganado con todo esto de la
inyección de dependencias. Y es normal, por que el concepto del Contenedor de
Servicios es una nueva forma de entender la programación orientada a objetos.

En esta sección vamos a indicar algunas de las cosas que hemos ganado al convertir
en servicio de <em>Symfony2</em> nuestra clase <tt class="docutils literal"><span class="pre">Model</span></tt>. Después seguiremos mostrando
las ventajas de Contenedor de Servicios implementando nuevos servicios para la
aplicación de gestión de alimentos.

La ventaja más inmediata es el hecho de poder instanciar un objeto <tt class="docutils literal"><span class="pre">Model</span></tt> sin
tener que pasarle nada ni conocer nada sobre sus dependencias, tan solo hay que
pedírselo al contenedor.

Otra cosa buena es que los parámetros de configuración son declarados en un fichero
de configuración y son accesibles desde cualquier otro fichero de configuración
usando el carácter <tt class="docutils literal"><span class="pre">%</span></tt> alrededor del nombre del parámetro. También se puede
obtener el valor de un determinado parámetro de configuración desde un controlador
utilizando el método <tt class="docutils literal"><span class="pre">getParameter()</span></tt>.
<div class="highlight-php">
    <div class="highlight">
<pre><span class="x">...</span>
<span class="x">$database = $this-&gt;getParameter('jamab.database_name');</span>
<span class="x">...</span></pre>
    </div>
</div>
En ocasiones resulta muy útil cambiar la clase que implementa un servicio.
Por ejemplo, si queremos realizar pruebas aisladas sobre la clase
<tt class="docutils literal"><span class="pre">DefaultController</span></tt> para comprobar que la lógica de control funciona como se
espera, es decir, pruebas en las que no interfiera la base de datos,
podemos utilizar en lugar de la clase <tt class="docutils literal"><span class="pre">Model</span></tt>, una clase “tonta” con la misma
interfaz pero independiente de la conexión a la base de datos. Por ejemplo la
siguiente:

<tt class="docutils literal"><span class="pre">src/Jazzyweb/AulasMentor/AlimentosBundle/Model/ModelMock.php</span></tt>
<div class="highlight-php">
    <table class="highlighttable">
        <tbody>
        <tr>
            <td class="linenos">
                <div class="linenodiv">
<pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66</pre>
                </div></td>
            <td class="code">
                <div class="highlight">
<pre><span class="cp">&lt;?php</span>

  <span class="k">namespace</span> <span class="nx">Jazzyweb\AulasMentor\AlimentosBundle\Model</span><span class="p">;</span>

  <span class="k">class</span> <span class="nc">ModelMock</span>
  <span class="p">{</span>
      <span class="k">protected</span> <span class="nv">$conexion</span><span class="p">;</span>

      <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$dbname</span><span class="p">,</span><span class="nv">$dbuser</span><span class="p">,</span><span class="nv">$dbpass</span><span class="p">,</span><span class="nv">$dbhost</span><span class="p">)</span>
      <span class="p">{</span>

      <span class="p">}</span>

      <span class="k">public</span> <span class="k">function</span> <span class="nf">dameAlimentos</span><span class="p">()</span>
      <span class="p">{</span>
          <span class="nv">$alimentos</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
              <span class="k">array</span><span class="p">(</span>
                  <span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="s1">'nombre'</span> <span class="o">=&gt;</span> <span class="s1">'pera'</span><span class="p">,</span>
                  <span class="s1">'energia'</span> <span class="o">=&gt;</span> <span class="s1">'90'</span><span class="p">,</span>
                  <span class="s1">'proteina'</span> <span class="o">=&gt;</span> <span class="s1">'80'</span><span class="p">,</span>
                  <span class="s1">'hidratocarbono'</span> <span class="o">=&gt;</span> <span class="s1">'78'</span><span class="p">,</span>
                  <span class="s1">'fibra'</span> <span class="o">=&gt;</span> <span class="s1">'89'</span><span class="p">,</span>
                  <span class="s1">'grasatotal'</span> <span class="o">=&gt;</span> <span class="s1">'98'</span><span class="p">,</span>
              <span class="p">),</span>
              <span class="k">array</span><span class="p">(</span>
                  <span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
                  <span class="s1">'nombre'</span> <span class="o">=&gt;</span> <span class="s1">'manzana'</span><span class="p">,</span>
                  <span class="s1">'energia'</span> <span class="o">=&gt;</span> <span class="s1">'94'</span><span class="p">,</span>
                  <span class="s1">'proteina'</span> <span class="o">=&gt;</span> <span class="s1">'60'</span><span class="p">,</span>
                  <span class="s1">'hidratocarbono'</span> <span class="o">=&gt;</span> <span class="s1">'38'</span><span class="p">,</span>
                  <span class="s1">'fibra'</span> <span class="o">=&gt;</span> <span class="s1">'83'</span><span class="p">,</span>
                  <span class="s1">'grasatotal'</span> <span class="o">=&gt;</span> <span class="s1">'48'</span><span class="p">,</span>
              <span class="p">),</span>
          <span class="p">);</span>

          <span class="k">return</span> <span class="nv">$alimentos</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">public</span> <span class="k">function</span> <span class="nf">buscarAlimentosPorNombre</span><span class="p">(</span><span class="nv">$nombre</span><span class="p">)</span>
      <span class="p">{</span>
          <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">dameAlimentos</span><span class="p">();</span>
      <span class="p">}</span>

      <span class="k">public</span> <span class="k">function</span> <span class="nf">dameAlimento</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
      <span class="p">{</span>
         <span class="nv">$alimento</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
             <span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
             <span class="s1">'nombre'</span> <span class="o">=&gt;</span> <span class="s1">'manzana'</span><span class="p">,</span>
             <span class="s1">'energia'</span> <span class="o">=&gt;</span> <span class="s1">'94'</span><span class="p">,</span>
             <span class="s1">'proteina'</span> <span class="o">=&gt;</span> <span class="s1">'60'</span><span class="p">,</span>
             <span class="s1">'hidratocarbono'</span> <span class="o">=&gt;</span> <span class="s1">'38'</span><span class="p">,</span>
             <span class="s1">'fibra'</span> <span class="o">=&gt;</span> <span class="s1">'83'</span><span class="p">,</span>
             <span class="s1">'grasatotal'</span> <span class="o">=&gt;</span> <span class="s1">'48'</span><span class="p">,</span>
         <span class="p">);</span>

          <span class="k">return</span> <span class="nv">$alimento</span><span class="p">;</span>

      <span class="p">}</span>

      <span class="k">public</span> <span class="k">function</span> <span class="nf">insertarAlimento</span><span class="p">(</span><span class="nv">$n</span><span class="p">,</span> <span class="nv">$e</span><span class="p">,</span> <span class="nv">$p</span><span class="p">,</span> <span class="nv">$hc</span><span class="p">,</span> <span class="nv">$f</span><span class="p">,</span> <span class="nv">$g</span><span class="p">)</span>
      <span class="p">{</span>
      <span class="p">}</span>

  <span class="p">}</span></pre>
                </div></td>
        </tr>
        </tbody>
    </table>
</div>
Fíjate que la clase <tt class="docutils literal"><span class="pre">ModelMock</span></tt> clase no requiere una conexión a la base de datos,
pero mantiene la misma interfaz que <tt class="docutils literal"><span class="pre">Model</span></tt>. Puedes probar a cambiar en el
archivo de configuración de los servicios del <em>bundle</em>, el nombre de la clase
que implementa el servicio <tt class="docutils literal"><span class="pre">jamab.model</span></tt>:

<tt class="docutils literal"><span class="pre">src/Jazzyweb/AulasMentor/AlimentosBundle/Resources/config/services.yml</span></tt>
<div class="highlight-yaml">
<pre> parameters:
   jamab.database_name: alimentos
   jamab.database_user: root
   jamab.database_password: root
   jamab.database_host: localhost
   jamab.model.class: Jazzyweb\AulasMentor\AlimentosBundle\Model\ModelMock

 services:
   jamab.model:
      class: %jamab.model.class%
      arguments: [%jamab.database_name%, %jamab.database_user%, %jamab.database_password%, %jamab.database_host%]</pre>
</div>
Si ejecutas la aplicación ahora puedes comprobar que todo sigue funcionando, aunque
los alimentos que devuelve son los especificados a “capón” en los arrays de la
clase <tt class="docutils literal"><span class="pre">ModelMock</span></tt>. Esto nos puede servir, como ya hemos dicho antes, para
construir <em>tests</em> con <em>PHPUnit</em> que comprueben la funcionalidad del controlador
<tt class="docutils literal"><span class="pre">DefaultController</span></tt> sin necesidad de “contaminar” las pruebas con posibles fallos
con la conexión a la base de datos. Todo esto es posible gracias al uso de objetos
(servicios) absolutamente desacoplados y que son “juntados” entre sí mediante la
inyección de dependencias.

Imáginemos ahora que, después de que nuestra aplicación de gestión de alimentos ha
crecido un montón, por “exigencias del guíon” nos han migrado los datos a un
sistema gestor de base de datos <em>Postgresql</em>. O que nos exigen hacerla compatible
también con este sistema. En tal caso podríamos crear una clase <tt class="docutils literal"><span class="pre">ModelPostgresql</span></tt>,
con la misma interfaz que <tt class="docutils literal"><span class="pre">Model</span></tt>, pero con los métodos adaptados para atacar
una base de datos <em>Postgresql</em>. Hecho esto, bastaría con cambiar en la
configuración la clase que implementa el servicio <tt class="docutils literal"><span class="pre">jamab.model</span></tt>.

Terminamos la sección “symfonizando” un poco más nuestro <em>bundle</em>. La distribución
standard de <em>Symfony2</em> proporciona el archivo <tt class="docutils literal"><span class="pre">app/config/parameters.ini</span></tt>,
con el objetivo de que se declaren ahí los parámetros globales de la aplicación.
Si lo abres verás que propone como tales a los parámetros de conexión a una base
de datos y a un servidor de correo. Por tanto deberíamos utilizar estos parámetros
como argumentos de nuestro servicio <tt class="docutils literal"><span class="pre">jamab.modle</span></tt>. Para ello basta con realizar
el cambio en el fichero <tt class="docutils literal"><span class="pre">services.yml</span></tt> del <em>bundle</em>:

<tt class="docutils literal"><span class="pre">src/Jazzyweb/AulasMentor/AlimentosBundle/Resources/config/services.yml</span></tt>
<div class="highlight-yaml">
<pre> parameters:
   jamab.model.class: Jazzyweb\AulasMentor\AlimentosBundle\Model\ModelMock

 services:
   jamab.model:
      class: %jamab.model.class%
      arguments: [%database_name%, %database_user%, %database_password%, %database_host%]</pre>
</div>
Ya no necesitamos los parámetros <tt class="docutils literal"><span class="pre">jamab.database_name</span></tt>, etcétera. Obviamente
debes colocar los valores correctos para la conexión a la base de datos en el
fichero de configuración global <tt class="docutils literal"><span class="pre">parameters.ini</span></tt>:

<tt class="docutils literal"><span class="pre">app/config/parameters.ini</span></tt>
<div class="highlight-yaml">
    <table class="highlighttable">
        <tbody>
        <tr>
            <td class="linenos">
                <div class="linenodiv">
<pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre>
                </div></td>
            <td class="code">
                <div class="highlight">
<pre><span class="p-Indicator">[</span><span class="nv">parameters</span><span class="p-Indicator">]</span>
 <span class="l-Scalar-Plain">database_driver   = pdo_mysql</span>
 <span class="l-Scalar-Plain">database_host     = localhost</span>
 <span class="l-Scalar-Plain">database_port     =</span>
 <span class="l-Scalar-Plain">database_name     = alimentos</span>
 <span class="l-Scalar-Plain">database_user     = root</span>
 <span class="l-Scalar-Plain">database_password = root</span>

 <span class="l-Scalar-Plain">mailer_transport  = smtp</span>
 <span class="l-Scalar-Plain">mailer_host       = localhost</span>
 <span class="l-Scalar-Plain">mailer_user       =</span>
 <span class="l-Scalar-Plain">mailer_password   =</span>

 <span class="l-Scalar-Plain">locale            = en</span>

 <span class="l-Scalar-Plain">secret            = ThisTokenIsNotSoSecretChangeIt</span></pre>
                </div></td>
        </tr>
        </tbody>
    </table>
</div>
</div>
<div class="section" id="servicios-al-poder">
<h2>¡<em>Servicios</em> al poder!<a class="headerlink" title="Enlazar permanentemente con este título" href="#servicios-al-poder">¶</a></h2>
Continuamos mostrando la potencia de los servicios. Ahora vamos a construir un
servicio que combinará el que acabamos de crear <tt class="docutils literal"><span class="pre">jamab.model</span></tt>, y el servicio de
<em>mailing</em> que viene incluido en <em>Symfony2</em>. Denominaremos al nuevo servicio
<tt class="docutils literal"><span class="pre">jamab.infosender</span></tt>, y su cometido será enviar por correo electrónico la
información que tenemos en nuestro sistema sobre un determinado alimento.

En primer lugar vamos a crear la clase que implementará el servicio. La llamaremos
<tt class="docutils literal"><span class="pre">InfoSender</span></tt> y la colocaremos en el espacio de nombres
<tt class="docutils literal"><span class="pre">Jazzyweb\AulasMentor\AlimentosBundle\Model</span></tt>, se alojará por tanto en el
directorio <tt class="docutils literal"><span class="pre">src/Jazzyweb/AulasMentor/AlimentosBundle/Model</span></tt>.

Dicha clase, para que cumpla el patrón y pueda integrarse como servicio, debe
recibir en su constructor un objeto <tt class="docutils literal"><span class="pre">jamab.model</span></tt> y otro <tt class="docutils literal"><span class="pre">mailer</span></tt> . Con el
primero buscará información sobre alimentos en el sistema, y con el segundo
enviará el e-mail con dicha información. La clase que nos hemos inventado para
este menester es la siguiente:

<tt class="docutils literal"><span class="pre">src/Jazzyweb/AulasMentor/AlimentosBundle/Model/InfoSender.php</span></tt>
<div class="highlight-php">
    <table class="highlighttable">
        <tbody>
        <tr>
            <td class="linenos">
                <div class="linenodiv">
<pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre>
                </div></td>
            <td class="code">
                <div class="highlight">
<pre><span class="cp">&lt;?php</span>

 <span class="k">namespace</span> <span class="nx">Jazzyweb\AulasMentor\AlimentosBundle\Model</span><span class="p">;</span>

 <span class="k">class</span> <span class="nc">InfoSender</span>
 <span class="p">{</span>

     <span class="k">protected</span> <span class="nv">$model</span><span class="p">;</span>
     <span class="k">protected</span> <span class="nv">$mailer</span><span class="p">;</span>

     <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="nv">$mailer</span><span class="p">)</span>
     <span class="p">{</span>
         <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">model</span> <span class="o">=</span> <span class="nv">$model</span><span class="p">;</span>
         <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mailer</span> <span class="o">=</span> <span class="nv">$mailer</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="k">public</span> <span class="k">function</span> <span class="nf">send</span><span class="p">(</span><span class="nv">$terminoBusqueda</span><span class="p">,</span> <span class="nv">$direccionEmail</span><span class="p">)</span>
     <span class="p">{</span>
         <span class="nv">$alimentos</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">model</span><span class="o">-&gt;</span><span class="na">buscarAlimentosPorNombre</span><span class="p">(</span><span class="nv">$terminoBusqueda</span><span class="p">);</span>

         <span class="nv">$texto</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
         <span class="k">foreach</span> <span class="p">(</span><span class="nv">$alimentos</span> <span class="k">as</span> <span class="nv">$alimento</span><span class="p">)</span>
         <span class="p">{</span>
             <span class="nv">$texto</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span> <span class="nv">$alimento</span><span class="p">);</span>
             <span class="nv">$texto</span> <span class="o">.=</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
         <span class="p">}</span>

         <span class="nv">$message</span> <span class="o">=</span> <span class="nx">\Swift_Message</span><span class="o">::</span><span class="na">newInstance</span><span class="p">()</span>
                 <span class="o">-&gt;</span><span class="na">setSubject</span><span class="p">(</span><span class="s1">'Información sobre alimentos'</span><span class="p">)</span>
                 <span class="o">-&gt;</span><span class="na">setFrom</span><span class="p">(</span><span class="s1">'noreplay@aulasmentor.com'</span><span class="p">)</span>
                 <span class="o">-&gt;</span><span class="na">setTo</span><span class="p">(</span><span class="nv">$direccionEmail</span><span class="p">)</span>
                 <span class="o">-&gt;</span><span class="na">setBody</span><span class="p">(</span><span class="nv">$texto</span><span class="p">)</span>
         <span class="p">;</span>

         <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
     <span class="p">}</span>
 <span class="p">}</span></pre>
                </div></td>
        </tr>
        </tbody>
    </table>
</div>
El constructor de la clase (líneas 11-15) recibe los objetos <tt class="docutils literal"><span class="pre">$model</span></tt> y
<tt class="docutils literal"><span class="pre">$mailer</span></tt> (o dicho de otra forma; los servicios <tt class="docutils literal"><span class="pre">jamab.model</span></tt> y <tt class="docutils literal"><span class="pre">mailer</span></tt>)
ya creados y bien configurados, y simplemente los asigna como atributos para que
puedan utilizarlos los métodos que se irán añadiendo al servicio.

El método <tt class="docutils literal"><span class="pre">send()</span></tt> del servicio (líneas 17-36), recibe como parámetros un
término de búsqueda y una dirección de correos. Entonces, utiliza el servicio
<tt class="docutils literal"><span class="pre">jamab.model</span></tt> (línea 19) para realizar una busqueda de alimentos en el sistema.
El resultado es usado para construir una cadena que servirá como cuerpo del e-mail
(líneas 21-26). A continuación se prepara un mensaje de e-mail (líneas 28-33) con
los campos correspondientes; <em>subject</em>, <em>from</em>, <em>to</em> y <em>body</em>, y se usa el
servicio de <em>mailing</em> de <em>Symfony2</em> (línea 35) para enviar el mensaje.
<div class="admonition note">
    <p class="first admonition-title">Nota</p>
    <p class="last">El servicio de <em>mailing</em> incorporado con <em>Symfony2</em> esta basado en la librería
        <em>SwiftMailer</em>, y para el envío de mensaje utiliza el método <tt class="docutils literal"><span class="pre">send()</span></tt> cuyo
        argumento debe ser una instancia de <tt class="docutils literal"><span class="pre">Swift_Message</span></tt>. La creación de esta
        instancia es lo que se realiza en las líneas 28-33.</p>

</div>
Algo importante y que hemos de resaltar. Durante el proceso de construcción
de la clase <tt class="docutils literal"><span class="pre">InfoSender</span></tt> no nos hemos preocupados por detalles de la configuración
de los servicios, simplemente sabíamos que existian y conocíamos sus funciones, las
hemos utilizado y se acabó. Es la consecuencia de haber separado la configuración
del uso. Gracias a ello, escribir un servicio que dependa de otro, o simplemente
utilizar un servicio es realmente sencillo.

El próximo paso es integrar la clase que acabamos de construir como servicio del
framework. Si has estado atento a todo lo que llevamos dicho en esta unidad, sabrás
que esto se hace añadiéndola al fichero de configuración <tt class="docutils literal"><span class="pre">services.yml</span></tt> del
<em>bundle</em>.

<tt class="docutils literal"><span class="pre">src/Jazzyweb/AulasMentor/AlimentosBundle/Resources/config/services.yml</span></tt>
<div class="highlight-yaml">
<pre>parameters:
   jamab.model.class: Jazzyweb\AulasMentor\AlimentosBundle\Model\Model
   jamab.infosender.class: Jazzyweb\AulasMentor\AlimentosBundle\Model\InfoSender

services:
   jamab.model:
      class: %jamab.model.class%
      arguments: [%database_name%, %database_user%, %database_password%, %database_host%]

   jamab.infosender:
      class: %jamab.infosender.class%
      arguments: [ @jamab.model, @mailer ]</pre>
</div>
La única explicación que merece el código anterior es que hay que tener en cuenta
que los argumentos que son servicios se representan anteponiendo el carácter <tt class="docutils literal"><span class="pre">@</span></tt>
a su nombre.

El último paso es asegurarnos de que todos los servicios que estamos usando están
bien configurados. Los de nuestra factura; <tt class="docutils literal"><span class="pre">jamab.model</span></tt> y <tt class="docutils literal"><span class="pre">jamab.infosender</span></tt>,
obviamente lo están (véase el código anterior). Nos falta comprobar el servicio
de <em>mailing</em>. Este servicio se configura en el archivo de configuración global
<tt class="docutils literal"><span class="pre">app/config/config.yml</span></tt>, en la sección <tt class="docutils literal"><span class="pre">swiftmailer</span></tt>.Echale un vistazo y fíjate
que hace referencia a los parámetros <tt class="docutils literal"><span class="pre">%mailer_transport%</span></tt>, <tt class="docutils literal"><span class="pre">%mailer_host%</span></tt>,
<tt class="docutils literal"><span class="pre">%mailer_user%</span></tt> y <tt class="docutils literal"><span class="pre">%mailer_password%</span></tt>. ¿Adivinas donde se definen tales
parámetros? Espero que así sea, significa que has estado leyendo la unidad con
atención. Se hace en el archivo <tt class="docutils literal"><span class="pre">src/config/parameters.ini</span></tt>, aunque podríamos
colocar los valores concretos directamente en el fichero <tt class="docutils literal"><span class="pre">config.yml</span></tt>, los
administradores de sistemas que van a instalar nuestra aplicación agredecerán
muchísimo que todos los parámetros de configuración que tengan que ver con los
servicios del sistema se encuentren juntitos en un sólo fichero (cuidado que ahora
la palabra <em>servicio</em> la estamos usando en un contexto de sistemas de información,
esto es, nos referimos a servicios de base da datos, de correo, etcétera).

Hemos utilizado una cuenta de <em>Gmail</em> para enviar emails. Para configurarla es
preciso añadir dos parámetros más: el tipo de encriptación y el modo de
autenticación (esto lo dice la documentación de <em>Gmail</em>). Por otro lado, en la
documentación oficial de <em>Symfony2</em> se dice que estos datos son mapeados por
<em>swiftmailer</em> a través de los parámetros <tt class="docutils literal"><span class="pre">encryption</span></tt> y <tt class="docutils literal"><span class="pre">auth_mode</span></tt>. La
sección <tt class="docutils literal"><span class="pre">swiftmailer</span></tt> del archivo de configuración global <tt class="docutils literal"><span class="pre">config.yml</span></tt> queda
así:

<tt class="docutils literal"><span class="pre">app/config/config.yml</span></tt>
<div class="highlight-yaml">
<pre>...
swiftmailer:
    transport:  %mailer_transport%
    username:   %mailer_user%
    password:   %mailer_password%
...</pre>
</div>
Y la declaración de los parámetros:

<tt class="docutils literal"><span class="pre">app/config/parameters.ini</span></tt>
<div class="highlight-yaml">
    <table class="highlighttable">
        <tbody>
        <tr>
            <td class="linenos">
                <div class="linenodiv">
<pre>1
2
3
4
5</pre>
                </div></td>
            <td class="code">
                <div class="highlight">
<pre> <span class="l-Scalar-Plain">...</span>
 <span class="l-Scalar-Plain">mailer_transport  = gmail</span>
 <span class="l-Scalar-Plain">mailer_user       = tuusername</span>
 <span class="l-Scalar-Plain">mailer_password   = tupassword</span>
 <span class="l-Scalar-Plain">...</span></pre>
                </div></td>
        </tr>
        </tbody>
    </table>
</div>
Y ya tenemos el servicio de <em>mailing</em> bien configurado y listo para ser usado.
Y ahora toca probarlo. Construiremos una ruta y una acción asociada para ello.

En <tt class="docutils literal"><span class="pre">src/Jazzyweb/AulasMentor/AlimentosBundle/Resources/config/routing.yml</span></tt>
añadimos la ruta:
<div class="highlight-yaml">
    <div class="highlight">
<pre><span class="l-Scalar-Plain">JAMAB_testinfosender</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">pattern</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">/testinfosender</span>
  <span class="l-Scalar-Plain">defaults</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">_controller</span><span class="p-Indicator">:</span> <span class="nv">JazzywebAulasMentorAlimentosBundle</span><span class="p-Indicator">:</span><span class="nv">Default</span><span class="p-Indicator">:</span><span class="nv">testInfoSender</span> <span class="p-Indicator">}</span></pre>
    </div>
</div>
Y en el <tt class="docutils literal"><span class="pre">DefaultController</span></tt> implementamos la acción correspondiente:

<tt class="docutils literal"><span class="pre">src/Jazzyweb/AulasMentor/AlimentosBundle/Controller/DefaultController.php</span></tt>
<div class="highlight-python">
<pre>&lt;?php
...
public function testInfoSenderAction()
  {
      $infosender = $this-&gt;get('jamab.infosender');

      $infosender-&gt;send('%naranja%', 'juandalibaba@gmail.com');

      return new \Symfony\Component\HttpFoundation\Response(
              '&lt;html&gt;&lt;body&gt;&lt;h2&gt;Se ha enviado información a
              juandalibaba@gmail.com&lt;/h2&gt;&lt;/body&gt;&lt;/html&gt;');
  }
...</pre>
</div>
Lanza esta ruta en tu navegador y se enviará información sobre el alimento
<em>naranja</em> a la dirección de e-mail que hayas elegido.
<div class="admonition note">
    <p class="first admonition-title">Nota</p>
    <p class="last">Sustituye <tt class="docutils literal"><span class="pre">tuusername</span></tt>, <tt class="docutils literal"><span class="pre">tupassword</span></tt> y <tt class="docutils literal"><span class="pre">quientuquieras@dondequieras.com</span></tt>
        por los valores propioso de tu cuenta de e-mail y por la dirección de correo
        contra la que deseas hacer pruebas.</p>

</div>
<div class="admonition note">
    <p class="first admonition-title">Nota</p>
    <p class="last">Observa que no hemos construido una plantilla para pintar la acción. Como es
        una prueba sencilla, hemos decidido construir directamente un objeto <tt class="docutils literal"><span class="pre">Response</span></tt>.</p>

</div>
El uso del servicio <tt class="docutils literal"><span class="pre">jamab.infosender</span></tt>, como todos los servicios de <em>Symfony2</em>
no puede ser más sencillo. Le dices al <em>Contenedor de Servicios</em>: <em>“dame el
    servicio fulanito”</em>, él te lo devuelve educadamente, sin hacerte preguntas, y tu
lo usas en tu aplicación. Que quieres usar otro servidor para enviar los mensajes.
No tienes que cambiar ni una línea de tu código. Cambias la configuración del
servicio de <em>mailing</em> y todo sigue funcionando. Que ahora resulta que no quieres
enviar mails mientras estás haciendo pruebas. Añades a la configuración de
<em>swiftmailer</em> el parámetro: <tt class="docutils literal"><span class="pre">disable_delivery:</span>  <span class="pre">true</span></tt> y se deshabilita el envío.
Son posibles situaciones prácticas que se te pueden dar en el desarrollo de tus
aplicaciones y que, gracias a la inyección de dependencias, se resuelven de una
manera muy sencilla y segura en el sentido de que realizas grandes cambios y todo
sigue funcionando, nada se rompe.

</div>
<div class="section" id="mas-servicios-aun">
    <h2>Más servicios aún<a class="headerlink" title="Enlazar permanentemente con este título" href="#mas-servicios-aun">¶</a></h2>
    No te apures ya hemos terminado, tan sólo queremos recalcar que <em>Symfony2</em> está
    compuesto por muchos servicios como los que hemos estudiado en esta unidad. Y
    que, por supuesto, los <em>bundles</em> de terceros más famosos utilizan extensiva e
    intensivamente la inyección de dependencia. Comprender bien este concepto te
    facilitará el aprendizaje y tu experiencia con <em>Symfony2</em>.
    <div class="admonition note">
        <p class="first admonition-title">Nota</p>
        Si quieres saber todos los servicios que vienen con <em>Symfony2</em> ejecuta este
        comando:
        <div class="last highlight-bash">
            <div class="highlight">
                <pre>php app/console container:debug</pre>
            </div>
        </div>
    </div>
    Es verdad que se pueden desarrollar aplicaciones con <em>Symfony2</em> sin necesidad de
    “echar mucha cuenta” a la inyección de dependencias. Basta con conocer los
    servicios más importantes proporcionados por <em>Symfony2</em>, instanciarlos en
    las acciones del controlador cuando los necesitas y utilizarlos. Sin embargo, si
    no prestas suficiente atención a este concepto y lo dejas un poco de lado,
    sentirás que no consigues controlar del todo al framework y en ocasiones se te
    escapa. Comprender la <em>inyección de dependencia</em>, el concepto de <em>servicio</em> y
    de <em>contenedor de servicios</em>, es fundamental para tomar las riendas del framework
    y cabalgar sobre él confortablemente. Este es el motivo esta unidad y de su
    ubicación a la mitad del curso, justo antes de comenzar a desarrollar una
    aplicación más compleja que servirá de vehículo vertebrador para aprender a
    utilizar <em>Symfony2</em>.

    En las unidades anteriores ya hemos utilizado los servicios de <em>Symfony2</em> sin
    haberlos mencionados. Cuando renderizamos los resultados de una acción con una
    plantilla, estamos haciendo uso del servicio <tt class="docutils literal"><span class="pre">templating</span></tt> a través del <em>wrapper</em>
    <tt class="docutils literal"><span class="pre">render()</span></tt> de la clase <tt class="docutils literal"><span class="pre">Controller</span></tt>. De hecho hacer esto:
    <div class="highlight-python">
        <pre>return $this-&gt;render('JazzywebAulasMentorAlimentosBundle:Default:index.html.twig', $params);</pre>
    </div>
    es equivalente a esto:
    <div class="highlight-python">
<pre>$t = $this-&gt;get('templating');

return $t-&gt;renderResponse('JazzywebAulasMentorAlimentosBundle:Default:index.html.twig', $params);</pre>
    </div>
    Pero más cortito.

    En las próximas unidades estudiaremos los servicios más importantes que ofrece
    <em>Symfony2</em>. Con ellos se puede hacer casi de todo. No obstante a veces tendremos
    que ampliar el framework con nuevas funcionalidades. Y esto, si queremos hacerlo
    bien, debemos hacerlo usando la inyección de dependencias y los servicios.

</div>
<div class="section" id="el-tutorial-en-chuletas">
    <h2>El tutorial en chuletas<a class="headerlink" title="Enlazar permanentemente con este título" href="#el-tutorial-en-chuletas">¶</a></h2>
    <ul class="simple">
        <li><em>Servicio</em>. Un tipo de objetos que realizan algún tipo de tarea “global” en el
            sistema.</li>
        <li>Las clases que se quieran integrar como servicios, se definen en el archivo
            <tt class="docutils literal"><span class="pre">Resources/config/services.yml</span></tt> del <em>bundle</em>.</li>
        <li>Ese archivo tiene dos secciones: <tt class="docutils literal"><span class="pre">parameters</span></tt> y <tt class="docutils literal"><span class="pre">services</span></tt>. La primera sirve
            para definir parámetros de configuración del <em>bundle</em> (que pueden ser utilizados
            por los servicios o en otras partes del <em>bundle</em>), y la segunda para declarar los
            servicios.</li>
        <li>Las clases que vayan a incorporarse como servicios deben “inyectar” sus
            dependencias (parámetros y otros servicios) a través de su constructor o de
            algún <em>setter</em>.</li>
    </ul>
    Ejemplo:
    <div class="highlight-yaml">
<pre>parameters:
  jamab.database_name: alimentos
  jamab.database_user: root
  jamab.database_password: root
  jamab.database_host: localhost
  jamab.model.class: Jazzyweb\AulasMentor\AlimentosBundle\Model\Model

services:
  jamab.model:
     class: %jamab.model.class%
     arguments: [%jamab.database_name%, %jamab.database_user%, %jamab.database_password%, %jamab.database_host%]</pre>
    </div>
    <ul class="simple">
        <li>Desde un controlador (que extienda la clase <tt class="docutils literal"><span class="pre">Symfony\Bundle\FrameworkBundle\Controller\Controller</span></tt>,
            se puede obtener cualquier servicio usando el método <tt class="docutils literal"><span class="pre">get()</span></tt>:</li>
    </ul>
    <div class="highlight-python">
        <pre>$servicio = $this-&gt;get('nombre_del_servicio');</pre>
    </div>
    <ul class="simple">
        <li>Desde ese controlador también se puede obtener los valores de los parámetros
            usando el método clase <tt class="docutils literal"><span class="pre">getParameter()</span></tt>:</li>
    </ul>
    <div class="highlight-python">
        <pre>$parametro = $this-&gt;getParameter('nombre_del_parametro');</pre>
    </div>
    <ul class="simple">
        <li>Los argumentos que son servicios se especifican colocando el carácter <tt class="docutils literal"><span class="pre">@</span></tt>
            delante del nombre:</li>
    </ul>
    <div class="highlight-yaml">
<pre>...
services:
  jamab.infosender:
     class: %jamab.infosender.class%
     arguments: [ @jamab.model, @mailer ]
...</pre>
    </div>
</div>